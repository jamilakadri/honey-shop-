<!-- Modern Header Section -->
<header class="page-header">
  <div class="container">
    <div class="header-content">
      <div class="user-profile-container" *ngIf="authService.isLoggedIn">
        <div class="profile-icon-only">
            <div class="avatar-icon">{{ getUserInitials() }}</div>
            
            <div class="dropdown-icon">
                <div class="user-info-header">
                    <span class="user-name-header">{{ getCurrentUser()?.firstName }} {{ getCurrentUser()?.lastName }}</span>
                    <span class="user-email-header">{{ getCurrentUser()?.email }}</span>
                </div>
                
                <!-- ADMIN DASHBOARD LINK -->
                <a *ngIf="authService.isAdmin" routerLink="/admin" class="dropdown-link admin-link">
                    <span><img src="speedometer.png" style="height: 20px; width: 20px;" alt=""></span> Dashboard Admin
                </a>
                <hr *ngIf="authService.isAdmin">
                
                <a routerLink="/profile" class="dropdown-link">
                    <span><img src="user.png" style="height: 20px; width: 20px;" alt=""></span>   Mon Profil
                </a>
                <a routerLink="/orders" class="dropdown-link">
                    <span><img src="parcel.png" style="height: 20px; width: 20px;" alt=""></span>   Mes Commandes
                </a>
                <a routerLink="/cart" class="dropdown-link">
                    <span><img src="shopping-cart.png" style="height: 20px; width: 20px;" alt=""></span>   Mon Panier
                </a>
                <hr>
                <button (click)="logout()" class="dropdown-link logout-link"> Se déconnecter</button>
            </div>
        </div>
    </div>
      <img src="/hivebg.png" class="imgbg"/>
      <div class="breadcrumb">
        <a routerLink="/"> Accueil</a>
        <span class="separator">.</span>
        <span class="current">Produits</span>
      </div>
      <h1>Nos Miels d'Exception</h1>
      <p class="subtitle">Découvrez notre sélection de miels naturels et authentiques, récoltés avec passion</p>
    </div>
  </div>
</header>

<!-- Main Content -->
<main class="product-list-page">
  <div class="container">
    
    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
      <div class="spinner-container">
        <div class="honey-spinner">
          <div class="honeycomb">
            <div class="hex"></div>
            <div class="hex"></div>
            <div class="hex"></div>
            <div class="hex"></div>
            <div class="hex"></div>
            <div class="hex"></div>
          </div>
        </div>
        <p style="color: #6B7280; font-weight: 500; font-size: 1.125rem;">Chargement des produits...</p>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-container">
      <div class="error-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
      </div>
      <h3>Erreur de chargement</h3>
      <p>{{ error }}</p>
      <button (click)="loadProducts()" class="btn-retry">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="23 4 23 10 17 10"></polyline>
          <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
        </svg>
        Réessayer
      </button>
    </div>

    <!-- Product Grid -->
    <div *ngIf="!loading && !error" class="product-grid-layout">
      
      <!-- Sidebar Filters (Desktop) -->
      <aside class="sidebar-filters">
        <div class="filters-header">
          <h3>Filtres</h3>
          <button (click)="clearFilters()" class="clear-filters">
            Tout effacer
          </button>
        </div>

        <!-- Search -->
        <div class="filter-group">
          <h4 class="filter-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            Recherche
          </h4>
          <div class="search-box">
            <input
              type="text"
              [(ngModel)]="searchTerm"
              (ngModelChange)="filterProducts()"
              placeholder="Rechercher un produit..."
              class="search-input"
            >
            <button class="search-btn">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
            </button>
          </div>
        </div>

        <!-- Categories -->
        <div class="filter-group">
          <h4 class="filter-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
            </svg>
            Catégories
          </h4>
          <div class="category-list">
            <label class="category-item">
              <input
                type="radio"
                name="category"
                [(ngModel)]="selectedCategory"
                (ngModelChange)="filterProducts()"
                value="all"
              >
              <span class="checkmark"></span>
              <span class="category-name">Tous les produits</span>
              <span class="category-count">{{ products.length }}</span>
            </label>
            <label *ngFor="let category of categories" class="category-item">
              <input
                type="radio"
                name="category"
                [(ngModel)]="selectedCategory"
                (ngModelChange)="filterProducts()"
                [value]="category.slug"
              >
              <span class="checkmark"></span>
              <span class="category-name">{{ category.name }}</span>
              <span class="category-count">{{ getCategoryCount(category.slug) }}</span>
            </label>
          </div>
        </div>

        <!-- Price Range -->
        <span>  </span>
        <br>

        <!-- Sort Options -->
        <div class="filter-group">
          <h4 class="filter-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <polyline points="19 12 12 19 5 12"></polyline>
            </svg>
            Trier par
          </h4>
          <select [(ngModel)]="sortBy" (ngModelChange)="filterProducts()" class="sort-select">
            <option value="featured">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
              </svg>
              En vedette
            </option>
            <option value="newest">Plus récent</option>
            <option value="price-low">Prix croissant</option>
            <option value="price-high">Prix décroissant</option>
            <option value="name-asc">Nom A → Z</option>
            <option value="name-desc">Nom Z → A</option>
          </select>
        </div>

        <!-- Results Summary -->
        <div class="results-summary">
          <p style="font-size: 1rem; color: #1F2937;">
            <strong style="color: #F59E0B; font-size: 1.25rem;">{{ filteredProducts.length }}</strong> 
            produit(s) trouvé(s)
          </p>
          <button *ngIf="filteredProducts.length < products.length" 
                  (click)="clearFilters()" 
                  class="btn-show-all">
            Voir tous les produits
          </button>
        </div>
      </aside>

      <!-- Mobile Filter Toggle -->
      <div class="mobile-filter-bar">
        <button (click)="toggleMobileFilters()" class="btn-filter-toggle">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
          </svg>
          <span>Filtres & Tri</span>
          <span class="filter-count" *ngIf="selectedCategory !== 'all' || searchTerm || priceSlider < 1000">
            {{ (selectedCategory !== 'all' ? 1 : 0) + (searchTerm ? 1 : 0) + (priceSlider < 1000 ? 1 : 0) }}
          </span>
        </button>
        
        <!-- Mobile Filter Panel -->
        <div *ngIf="showMobileFilters" class="mobile-filters-panel">
          <div class="mobile-filters-header">
            <h3>Filtres</h3>
            <button (click)="toggleMobileFilters()" class="close-filters">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          <div class="mobile-filters-content">
            <div class="filter-group">
              <h4>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>
                Recherche
              </h4>
              <input
                type="text"
                [(ngModel)]="searchTerm"
                (ngModelChange)="filterProducts()"
                placeholder="Rechercher..."
                class="mobile-search"
              >
            </div>
            
            <div class="filter-group">
              <h4>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                </svg>
                Catégorie
              </h4>
              <select [(ngModel)]="selectedCategory" (ngModelChange)="filterProducts()" class="mobile-select">
                <option value="all">Toutes les catégories</option>
                <option *ngFor="let category of categories" [value]="category.slug">
                  {{ category.name }}
                </option>
              </select>
            </div>
            
            <div class="filter-group">
              <h4>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <polyline points="19 12 12 19 5 12"></polyline>
                </svg>
                Trier par
              </h4>
              <select [(ngModel)]="sortBy" (ngModelChange)="filterProducts()" class="mobile-select">
                <option value="featured">En vedette</option>
                <option value="newest">Plus récent</option>
                <option value="price-low">Prix croissant</option>
                <option value="price-high">Prix décroissant</option>
              </select>
            </div>
            
            <div class="mobile-filter-actions">
              <button (click)="clearFilters()" class="btn-clear">Effacer tout</button>
              <button (click)="toggleMobileFilters()" class="btn-apply">Appliquer</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <section class="main-content">
        
        <!-- Products Grid -->
        <div *ngIf="filteredProducts.length > 0; else noProducts" class="products-grid">
          <article *ngFor="let product of paginatedProducts" class="product-card">
            
            <!-- Product Image -->
            <div class="product-image-container">
              <a [routerLink]="['/products', product.slug]" class="product-image-link">
                <img
                  [src]="getProductImage(product)"
                  [alt]="product.name"
                  class="product-image"
                  loading="lazy"
                />
              </a>
              
              <!-- Badges -->
              <div class="product-badges">
                <span *ngIf="product.compareAtPrice && product.compareAtPrice > product.price" 
                      class="badge discount">
                  -{{ calculateDiscount(product) }}%
                </span>
                <span *ngIf="product.stockQuantity === 0" class="badge out-of-stock">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="15" y1="9" x2="9" y2="15"></line>
                    <line x1="9" y1="9" x2="15" y2="15"></line>
                  </svg>
                  Rupture
                </span>
                <span *ngIf="product.stockQuantity > 0 && product.stockQuantity <= 10" 
                      class="badge low-stock">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                  </svg>
                  Stock limité
                </span>
              </div>
            </div>

            <!-- Product Info -->
            <div class="product-info">
              <!-- Category Tag -->
              <span *ngIf="product.category" class="product-category">
                {{ product.category.name }}
              </span>
              
              <!-- Product Name -->
              <a [routerLink]="['/products', product.slug]" class="product-name">
                {{ product.name }}
              </a>
              
              <!-- Short Description -->
              <p class="product-description">
                {{ (product.shortDescription || product.description || '').substring(0, 100) }}...
              </p>
              
              <!-- Rating -->
              <div *ngIf="getAverageRating(product) > 0" class="product-rating">
                <div class="stars">
                  <span *ngFor="let star of [1,2,3,4,5]" 
                        [class.filled]="star <= getAverageRating(product)">★</span>
                </div>
                <span class="rating-count">({{ getReviewCount(product) }})</span>
              </div>

              <!-- Price -->
              <div class="product-price">
                <span class="current-price">{{ formatPrice(product.price) }}</span>
                <span *ngIf="product.compareAtPrice && product.compareAtPrice > product.price" 
                      class="original-price">
                  {{ formatPrice(product.compareAtPrice) }}
                </span>
              </div>

              <!-- Meta Info -->
              <div class="product-meta">
                <span *ngIf="product.origin" class="meta-item">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                  </svg>
                  {{ product.origin }}
                </span>
                <span>   </span>
                <span *ngIf="product.weight" class="meta-item">
                  <img src="weight.png" alt="" style="width: 14px; height: 14px;"> {{ product.weight }}g
                </span>
                <span>   </span>
                <span *ngIf="product.stockQuantity > 0" class="meta-item stock">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                  {{ product.stockQuantity }} disponible(s)
                </span>
              </div>

              <!-- Action Buttons -->
              <div class="product-actions">
                <a [routerLink]="['/products', product.slug]" class="btn-details">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                  Voir détails
                </a>
                <button
                  (click)="addToCart(product)"
                  [disabled]="product.stockQuantity === 0"
                  class="btn-add-cart"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="9" cy="21" r="1"></circle>
                    <circle cx="20" cy="21" r="1"></circle>
                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                  </svg>
                  Ajouter
                </button>
              </div>
            </div>
          </article>
        </div>

        <!-- No Products Found -->
        <ng-template #noProducts>
          <div class="no-products-found">
            <div class="empty-state">
              <div class="empty-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M16 16s-1.5-2-4-2-4 2-4 2"></path>
                  <line x1="9" y1="9" x2="9.01" y2="9"></line>
                  <line x1="15" y1="9" x2="15.01" y2="9"></line>
                </svg>
              </div>
              <h3>Aucun produit trouvé</h3>
              <p>Essayez de modifier vos critères de recherche ou de supprimer les filtres.</p>
              <button (click)="clearFilters()" class="btn-reset-filters">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
                Réinitialiser les filtres
              </button>
            </div>
          </div>
        </ng-template>

        <!-- Pagination -->
        <nav *ngIf="totalPages > 1" class="pagination" aria-label="Pagination des produits">
          <button 
            (click)="changePage(currentPage - 1)" 
            [disabled]="currentPage === 1" 
            class="pagination-arrow prev"
            aria-label="Page précédente"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
            Précédent
          </button>
          
          <div class="pagination-numbers">
            <button 
              *ngFor="let page of getPageNumbers()" 
              (click)="changePage(page)"
              [class.active]="page === currentPage"
              class="page-number"
              [attr.aria-label]="'Page ' + page"
              [attr.aria-current]="page === currentPage ? 'page' : null"
            >
              {{ page }}
            </button>
            
            <span *ngIf="totalPages > getPageNumbers().length && getPageNumbers()[getPageNumbers().length - 1] < totalPages" 
                  class="ellipsis">...</span>
            
            <button 
              *ngIf="getPageNumbers()[getPageNumbers().length - 1] < totalPages" 
              (click)="changePage(totalPages)"
              class="page-number last"
              [attr.aria-label]="'Page ' + totalPages"
            >
              {{ totalPages }}
            </button>
          </div>
          
          <button 
            (click)="changePage(currentPage + 1)" 
            [disabled]="currentPage === totalPages" 
            class="pagination-arrow next"
            aria-label="Page suivante"
          >
            Suivant
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
        </nav>
      </section>
    </div>
  </div>
</main>

<!-- Newsletter Section -->
<section class="newsletter-section">
  <div class="container">
    <div class="newsletter-content">
      <div class="honey-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
          <polyline points="22,6 12,13 2,6"></polyline>
        </svg>
      </div>
      <h2>Restez informé</h2>
      <p>Inscrivez-vous à notre newsletter pour recevoir nos nouvelles recettes et offres spéciales</p>
      <form class="newsletter-form" (submit)="$event.preventDefault()">
        <input 
          type="email" 
          placeholder="Votre adresse email" 
          class="newsletter-input"
          required
          aria-label="Adresse email pour la newsletter"
        >
        <button type="submit" class="newsletter-btn">
          S'inscrire
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
        </button>
      </form>
    </div>
  </div>
</section>