<header class="page-header">
  <div class="container">
    <div class="header-content">
      <div class="user-profile-container" *ngIf="authService.isLoggedIn">
        <div class="profile-icon-only">
            <div class="avatar-icon">{{ getUserInitials() }}</div>
            
            <div class="dropdown-icon">
                <div class="user-info-header">
                    <span class="user-name-header">{{ getCurrentUser()?.firstName }} {{ getCurrentUser()?.lastName }}</span>
                    <span class="user-email-header">{{ getCurrentUser()?.email }}</span>
                </div>
                
                <!-- ADMIN DASHBOARD LINK -->
                <a *ngIf="authService.isAdmin" routerLink="/admin" class="dropdown-link admin-link">
                    <span><img src="speedometer.png" style="height: 20px; width: 20px;" alt=""></span> Tableau de Bord Admin
                </a>
                <hr *ngIf="authService.isAdmin">
                
                <a routerLink="/profile" class="dropdown-link">
                    <span><img src="user.png" style="height: 20px; width: 20px;" alt=""></span>   Mon Profil
                </a>
                <a routerLink="/orders" class="dropdown-link">
                    <span><img src="parcel.png" style="height: 20px; width: 20px;" alt=""></span>   Mes Commandes
                </a>
                <a routerLink="/cart" class="dropdown-link">
                    <span><img src="shopping-cart.png" style="height: 20px; width: 20px;" alt=""></span>   Mon Panier
                </a>
                <hr>
                <button (click)="logout()" class="dropdown-link logout-link"> Se déconnecter</button>
            </div>
        </div>
    </div>
      <img src="/hivebg.png" class="imgbg"/>
      <div class="breadcrumb">
        <a routerLink="/"> Accueil</a>
        <span class="separator">.</span>
        <span class="current">Mes Commandes</span>
      </div>
      <h1>Mes Commandes</h1>
      <p class="subtitle">Suivez et gérez vos commandes de miel</p>
    </div>
  </div>
</header>
<div class="order-list-container">
  <div class="header">

    <div class="header-content">
      <h1>
        <span *ngIf="isAdmin">Toutes les Commandes</span>
      </h1>

      <p *ngIf="isAdmin">Gérer les commandes clients</p>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading" *ngIf="loading">
    <div class="spinner"></div>
    <p>Chargement de vos commandes...</p>
  </div>

  <!-- Error Message -->
  <div class="error-message" *ngIf="errorMessage && !loading">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="15" y1="9" x2="9" y2="15"></line>
      <line x1="9" y1="9" x2="15" y2="15"></line>
    </svg>
    {{ errorMessage }}
  </div>

  <!-- Orders List -->
  <div class="orders-grid" *ngIf="!loading && !errorMessage && orders.length > 0">
    <div class="order-card" *ngFor="let order of orders" (click)="viewOrderDetails(order)">
      <div class="order-header">
        <div class="order-id">
          <strong>{{ order.orderNumber }}</strong>
        </div>
        <span class="status-badge" [ngClass]="getStatusClass(order.orderStatus)">
          {{ order.orderStatus }}
        </span>
      </div>

      <div class="order-body">
        <div class="order-info">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          <span>{{ formatDate(order.orderDate) }}</span>
        </div>

        <div class="order-info">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
            <line x1="3" y1="6" x2="21" y2="6"></line>
          </svg>
          <span>{{ order.orderItems?.length || 0 }} article(s)</span>
        </div>

        <div class="order-info">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
            <line x1="1" y1="10" x2="23" y2="10"></line>
          </svg>
          <span class="status-badge" [ngClass]="getPaymentStatusClass(order.paymentStatus)">
            {{ order.paymentStatus }}
          </span>
        </div>
      </div>

      <div class="order-footer">
        <div class="order-total">
          <span class="total-label">Total:</span>
          <span class="total-amount">{{ order.totalAmount.toFixed(2) }} DT</span>
        </div>
        <button class="view-btn">
          Voir Détails
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!loading && !errorMessage && orders.length === 0">
    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <path d="M16 10a4 4 0 0 1-8 0"></path>
    </svg>
    <h2>Aucune Commande</h2>
    <p>Vous n'avez pas encore passé de commande. Commencez vos achats de délicieux miel !</p>
  </div>

  <!-- Order Details Modal -->
  <div class="modal-overlay" *ngIf="selectedOrder" (click)="closeOrderDetails()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ selectedOrder.orderNumber }}</h2>
        <button class="close-btn" (click)="closeOrderDetails()">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="modal-body">
        <div class="detail-row">
          <span class="detail-label">Statut de la Commande:</span>
          <span class="status-badge" [ngClass]="getStatusClass(selectedOrder.orderStatus)">
            {{ selectedOrder.orderStatus }}
          </span>
        </div>

        <div class="detail-row">
          <span class="detail-label">Statut du Paiement:</span>
          <span class="status-badge" [ngClass]="getPaymentStatusClass(selectedOrder.paymentStatus)">
            {{ selectedOrder.paymentStatus }}
          </span>
        </div>

        <div class="detail-row">
          <span class="detail-label">Date de Commande:</span>
          <span>{{ formatDate(selectedOrder.orderDate) }}</span>
        </div>

        <div class="price-breakdown">
          <h3>Détail des Prix</h3>
          <div class="price-row">
            <span>Sous-total:</span>
            <span>{{ selectedOrder.subTotal.toFixed(2) }} DT</span>
          </div>
          <div class="price-row">
            <span>Livraison:</span>
            <span>{{ selectedOrder.shippingCost.toFixed(2) }} DT</span>
          </div>
          <div class="price-row">
            <span>Taxe:</span>
            <span>{{ selectedOrder.tax.toFixed(2) }} DT</span>
          </div>
          <div class="price-row" *ngIf="selectedOrder.discountAmount > 0">
            <span>Réduction:</span>
            <span class="discount">-{{ selectedOrder.discountAmount.toFixed(2) }} DT</span>
          </div>
          <div class="price-row total-row">
            <span>Total:</span>
            <span class="detail-amount">{{ selectedOrder.totalAmount.toFixed(2) }} DT</span>
          </div>
        </div>

        <div class="items-section" *ngIf="selectedOrder.orderItems && selectedOrder.orderItems.length > 0">
          <h3>Articles Commandés</h3>
          <div class="item-card" *ngFor="let item of selectedOrder.orderItems">
            <div class="item-info">
              <span class="item-name">{{ item.productName }}</span>
              <span class="item-quantity">Qté: {{ item.quantity }} × {{ item.unitPrice.toFixed(2) }} DT</span>
            </div>
            <span class="item-price">{{ item.totalPrice.toFixed(2) }} DT</span>
          </div>
        </div>

        <div class="notes-section" *ngIf="selectedOrder.notes">
          <h3>Notes</h3>
          <p>{{ selectedOrder.notes }}</p>
        </div>

        <!-- Admin: Order Status Management -->
        <div class="admin-actions" *ngIf="isAdmin">
          <h3>Mettre à Jour le Statut</h3>
          <div class="status-buttons">
            <button class="status-btn pending" (click)="updateOrderStatus(selectedOrder.orderId, 'Pending')">
              En Attente
            </button>
            <button class="status-btn processing" (click)="updateOrderStatus(selectedOrder.orderId, 'Processing')">
              En Traitement
            </button>
            <button class="status-btn shipped" (click)="updateOrderStatus(selectedOrder.orderId, 'Shipped')">
              Expédiée
            </button>
            <button class="status-btn delivered" (click)="updateOrderStatus(selectedOrder.orderId, 'Delivered')">
              Livrée
            </button>
          </div>
        </div>

        <!-- Cancel Order Button (for customers, only if order is Pending) -->
        <div class="cancel-section" *ngIf="!isAdmin && selectedOrder.orderStatus.toLowerCase() === 'pending'">
          <button class="cancel-btn" (click)="cancelOrder(selectedOrder.orderId)">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="15" y1="9" x2="9" y2="15"></line>
              <line x1="9" y1="9" x2="15" y2="15"></line>
            </svg>
            Annuler la Commande
          </button>
        </div>
      </div>
    </div>
  </div>
</div>